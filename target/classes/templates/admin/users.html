<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pin2Fix - Users Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0f172a;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 260px;
            height: 100vh;
            background: #1e293b;
            padding: 20px;
            z-index: 1000;
        }

        .sidebar .brand {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 2rem;
        }

        .sidebar .brand i {
            margin-right: 10px;
            color: #38bdf8;
        }

        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.7);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 5px;
        }

        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background: rgba(56, 189, 248, 0.1);
            color: #38bdf8;
        }

        .sidebar .nav-link i {
            width: 25px;
        }

        .main-content {
            margin-left: 260px;
            padding: 20px 30px;
            min-height: 100vh;
            background: linear-gradient(180deg, #0f172a 0%, #1e293b 100%);
        }

        .table-dark-custom {
            background: #1e293b;
            border-radius: 15px;
            overflow: hidden;
        }

        .table-dark-custom th {
            background: #334155;
            color: #94a3b8;
            font-weight: 600;
            border: none;
        }

        .table-dark-custom td {
            color: #e2e8f0;
            border-color: #334155;
            vertical-align: middle;
        }

        .role-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .role-CITIZEN {
            background: rgba(56, 189, 248, 0.1);
            color: #38bdf8;
        }

        .role-GOV_BODY {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .role-DEPT_HEAD {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .role-AREA_HEAD {
            background: rgba(168, 85, 247, 0.1);
            color: #a855f7;
        }

        .role-WORKER {
            background: rgba(236, 72, 153, 0.1);
            color: #ec4899;
        }

        .role-ADMIN {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .search-box {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 10px 15px;
            color: white;
        }

        .search-box:focus {
            background: #1e293b;
            color: white;
            border-color: #38bdf8;
            box-shadow: none;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <div class="brand"><i class="fas fa-shield-alt"></i> Pin2Fix</div>
        <nav class="nav flex-column">
            <a class="nav-link" th:href="@{/admin/dashboard}"><i class="fas fa-chart-line"></i> Dashboard</a>
            <a class="nav-link active" th:href="@{/admin/users}"><i class="fas fa-users"></i> Users</a>
            <a class="nav-link" th:href="@{/admin/issues}"><i class="fas fa-exclamation-circle"></i> Issues</a>
            <a class="nav-link" th:href="@{/logout}"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
    </div>

    <div class="main-content">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 style="color: white; font-weight: 700;"><i class="fas fa-users me-2"></i>Users Management</h1>
                <p class="mb-0" style="color: #94a3b8;">Manage all system users</p>
            </div>
        </div>

        <!-- Filters -->
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <input type="text" class="form-control search-box" placeholder="Search by name or email..."
                    id="searchInput">
            </div>
            <div class="col-md-3">
                <select class="form-select search-box" id="roleFilter">
                    <option value="">All Roles</option>
                    <option value="CITIZEN">Citizen</option>
                    <option value="GOV_BODY">Gov Body</option>
                    <option value="DEPT_HEAD">Dept Head</option>
                    <option value="AREA_HEAD">Area Head</option>
                    <option value="WORKER">Worker</option>
                    <option value="ADMIN">Admin</option>
                </select>
            </div>
        </div>

        <div class="table-dark-custom">
            <div class="table-responsive">
                <table class="table table-dark-custom mb-0" id="usersTable">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Role</th>
                            <th>Department</th>
                            <th>Area</th>
                            <th>Joined</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="u : ${users}">
                            <td th:text="${u.userId}">#1</td>
                            <td>
                                <div class="d-flex align-items-center">
                                    <div class="rounded-circle d-flex align-items-center justify-content-center me-2"
                                        style="width:35px;height:35px;background:#334155;">
                                        <i class="fas fa-user" style="color:#94a3b8;"></i>
                                    </div>
                                    <span th:text="${u.name}">Name</span>
                                </div>
                            </td>
                            <td th:text="${u.email}">email@example.com</td>
                            <td th:text="${u.phone ?: '-'}">Phone</td>
                            <td><span class="role-badge" th:classappend="'role-' + ${u.role}"
                                    th:text="${u.role}">Role</span></td>
                            <td th:text="${u.department?.name ?: '-'}">Dept</td>
                            <td th:text="${u.areaCode ?: '-'}">Area</td>
                            <td th:text="${#temporals.format(u.createdAt, 'dd MMM yyyy')}">Date</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.getElementById('searchInput').addEventListener('keyup', filterTable);
        document.getElementById('roleFilter').addEventListener('change', filterTable);

        function filterTable() {
            var search = document.getElementById('searchInput').value.toLowerCase();
            var role = document.getElementById('roleFilter').value;
            var rows = document.querySelectorAll('#usersTable tbody tr');

            rows.forEach(function (row) {
                var name = row.cells[1].textContent.toLowerCase();
                var email = row.cells[2].textContent.toLowerCase();
                var rowRole = row.cells[4].textContent.trim();

                var matchSearch = name.includes(search) || email.includes(search);
                var matchRole = !role || rowRole === role;

                row.style.display = matchSearch && matchRole ? '' : 'none';
            });
        }
    </script>
</body>

</html>